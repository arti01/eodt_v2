<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets" 
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                template="/templates/templateGPF.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions">
    <ui:define name="tytul">
        <h3 align="center">Twoje wnioski urlopowe</h3>
    </ui:define>
    <ui:define name="content" id="content">
        <h:form id="center">
            <p:defaultCommand target="dummy"/>
            <p:commandButton id="dummy" process="@none" global="false" style="display:none;"/>

            <p:fieldset id="formWprow" collapsed="true" toggleable="true" legend="Dodaj wniosek (zwiń/rozwiń)" widgetVar="formWprowV">
                <p:panelGrid columns="3" id="form" columnClasses="column1, column2">
                    <p:outputLabel for="name" value="Imię i nazwisko: "/>
                    <h:inputText id="name" value="#{UrlopM.urlop.uzytkownik.fullname}"  size="50" readonly="true"/>
                    <p:message for="name" styleClass="error" />

                    <p:outputLabel for="rodzajW" value="Zwracam się z prośbą o udzielenie urlopu (rodzaj):"/>
                    <p:selectOneMenu id="rodzajW" value="#{UrlopM.urlop.rodzajId}" converter="#{WnRodzajeConv}">
                        <f:selectItems value="#{UrlopM.rodzajeC.findWnRodzajeEntities}" var="rodzaj" itemValue="#{rodzaj}" itemLabel="#{rodzaj.opis}"/>
                        <p:ajax update="form" process="rodzajW"/>
                    </p:selectOneMenu>
                    <p:message for="rodzajW" styleClass="error" />

                    <p:outputLabel value="cały dzień?"/>
                    <p:selectBooleanCheckbox value="#{UrlopM.calyDzien}" id="calyDzien">
                        <p:ajax event="change" update="form" process="calyDzien"/>
                    </p:selectBooleanCheckbox>
                    <p:outputLabel/>


                    <p:outputLabel for="data_od" value="Data od:" rendered="#{UrlopM.calyDzien}"/>
                    <p:calendar id="data_od" value="#{UrlopM.urlop.dataOd}" pattern="yyyy-MM-dd" locale="pl" rendered="#{UrlopM.calyDzien}"/>
                    <p:message for="data_od" styleClass="error" rendered="#{UrlopM.calyDzien}"/>

                    <p:outputLabel for="data_do" value="Data do:" rendered="#{UrlopM.calyDzien}"/>
                    <p:calendar id="data_do" value="#{UrlopM.urlop.dataDo}" pattern="yyyy-MM-dd" locale="pl" rendered="#{UrlopM.calyDzien}"/>
                    <p:message for="data_do" styleClass="error" rendered="#{UrlopM.calyDzien}"/>

                    <p:outputLabel for="data_url" value="Dzień urlopu:" rendered="#{!UrlopM.calyDzien}"/>
                    <p:calendar id="data_url" value="#{UrlopM.dataUrlopu}" pattern="yyyy-MM-dd" locale="pl" rendered="#{!UrlopM.calyDzien}"/>
                    <p:message for="data_url" styleClass="error" rendered="#{!UrlopM.calyDzien}"/>

                    <p:outputLabel value="Godzina od:" rendered="#{!UrlopM.calyDzien}"/>
                    <h:inputText id="data_od_godz" value="#{UrlopM.godzOd}" validatorMessage="wprowadź poprawną godzinę w formacie HH:MM, np. 08:00" rendered="#{!UrlopM.calyDzien}">
                        <f:validateRegex pattern="(?:2[0-3]|[01][0-9]):[0-5][0-9]"/>
                    </h:inputText>
                    <p:message for="data_od_godz" styleClass="error"  rendered="#{!UrlopM.calyDzien}"/>

                    <p:outputLabel for="data_do_godz" value="Godzina do:" rendered="#{!UrlopM.calyDzien}"/>
                    <h:inputText id="data_do_godz" value="#{UrlopM.godzDo}" validatorMessage="wprowadź poprawną godzinę w formacie HH:MM, np. 08:00" rendered="#{!UrlopM.calyDzien}">
                        <f:validateRegex pattern="(?:2[0-3]|[01][0-9]):[0-5][0-9]" />
                    </h:inputText>
                    <p:message for="data_do_godz" styleClass="error"  rendered="#{!UrlopM.calyDzien}"/>

                    <p:outputLabel for="extraemail" value="czy wysłać informacje na dodatkowe e-maile?" rendered="#{fn:length(UrlopM.urlop.uzytkownik.struktura.extraemail)>0}"/>
                    <h:selectBooleanCheckbox value="#{UrlopM.urlop.extraemail}" rendered="#{fn:length(UrlopM.urlop.uzytkownik.struktura.extraemail)>0}"/>
                    <h:outputText id="extraemail" value="#{UrlopM.urlop.uzytkownik.struktura.extraemail}" rendered="#{fn:length(UrlopM.urlop.uzytkownik.struktura.extraemail)>0}"/>

                    <p:outputLabel for="infoDod" value="informacje dodatkowe: "/>
                    <h:inputTextarea id="infoDod" value="#{UrlopM.urlop.infoDod}" cols="52"/>
                    <p:message for="infoDod" styleClass="error" />

                    <p:outputLabel for="miejsce" value="delegacja - miejsce: " rendered="#{UrlopM.urlop.rodzajId.id==5 or UrlopM.urlop.rodzajId.id==6}"/>
                    <h:inputText id="miejsce" value="#{UrlopM.urlop.miejsce}" size="50" rendered="#{UrlopM.urlop.rodzajId.id==5 or UrlopM.urlop.rodzajId.id==6}"/>
                    <p:message for="miejsce" styleClass="error"  rendered="#{UrlopM.urlop.rodzajId.id==5 or UrlopM.urlop.rodzajId.id==6}"/>

                    <p:outputLabel for="cel" value="delegacja - cel: " rendered="#{UrlopM.urlop.rodzajId.id==5 or UrlopM.urlop.rodzajId.id==6}"/>
                    <h:inputText id="cel" value="#{UrlopM.urlop.cel}" size="50" rendered="#{UrlopM.urlop.rodzajId.id==5 or UrlopM.urlop.rodzajId.id==6}"/>
                    <p:message for="cel" styleClass="error"  rendered="#{UrlopM.urlop.rodzajId.id==5 or UrlopM.urlop.rodzajId.id==6}"/>

                    <p:outputLabel for="srodekLok" value="delegacja - srodek lokomocji: " rendered="#{UrlopM.urlop.rodzajId.id==5 or UrlopM.urlop.rodzajId.id==6}"/>
                    <h:inputText id="srodekLok" value="#{UrlopM.urlop.srodekLok}" size="50" rendered="#{UrlopM.urlop.rodzajId.id==5 or UrlopM.urlop.rodzajId.id==6}"/>
                    <p:message for="srodekLok" styleClass="error"  rendered="#{UrlopM.urlop.rodzajId.id==5 or UrlopM.urlop.rodzajId.id==6}"/>

                </p:panelGrid>
                <center>
                    <p:message for="dodaj" styleClass="error"/>
                    <p:commandButton id="dodaj" value="Zapisz wniosek" action="#{UrlopM.dodaj}" update="formTab, formWprow" process="formWprow" oncomplete="PF('tableV').clearFilters()"/>
                </center>
            </p:fieldset>

            <p:outputPanel id="formTab" layout="block">
                <p:dataTable value="#{UrlopM.urlopyList}" var="urlop" id="table" paginator="true" rows="10" sortBy="#{urlop.id}" sortOrder="descending" widgetVar="tableV" emptyMessage="brak danych">
                    <p:column headerText="Wniosek złożony przez">
                        <h:outputText value="#{urlop.przyjmujacy.fullname}" rendered="#{urlop.przyjmujacy!=null}"/>
                        <h:outputText value="#{urlop.uzytkownik.fullname}" rendered="#{urlop.przyjmujacy==null}"/>
                    </p:column>
                    <p:column headerText="Nr wniosku" filterBy="#{urlop.nrWniosku}" filterMatchMode="contains">
                        <h:outputText value="#{urlop.nrWniosku}"/>
                        <hr/>
                        <h:outputText value="#{urlop.infoDod}" rendered="#{fn:length(urlop.infoDod)>0}"/>
                    </p:column>
                    <p:column headerText="Rodzaj" filterBy="#{urlop.rodzajId.opis}" filterMatchMode="contains">
                        <h:outputText value="#{urlop.rodzajId.opis}"/>
                    </p:column>
                    <p:column headerText="Wprowadzony" sortBy="#{urlop.dataWprowadzenia}">
                        <h:outputText value="#{urlop.dataWprowadzenia}"><f:convertDateTime type="date" pattern="yyyy-MM-dd HH:mm:ss" timeZone="CET"/></h:outputText>
                    </p:column>
                    <p:column headerText="Od Do" sortBy="#{urlop.dataOd}">
                        <h:outputText value="#{urlop.dataOd}"><f:convertDateTime type="date" pattern="yyyy-MM-dd HH:mm" locale="#{UrlopM.locale}" timeZone="CET"/></h:outputText>
                        <br/>
                        <h:outputText value="#{urlop.dataDo}"><f:convertDateTime type="date" pattern="yyyy-MM-dd HH:mm" locale="#{UrlopM.locale}" timeZone="CET"/></h:outputText>
                    </p:column>
                    <p:column headerText="Status" filterBy="#{urlop.statusId.opis}" filterMatchMode="contains" style="background-color: #{urlop.statusId.kolor} ; text-align: center">
                        <h:outputText value="#{urlop.statusId.opis}"/>
                    </p:column>
                    <p:column headerText="Akceptant" filterBy="#{urlop.akceptant.fullname}" filterMatchMode="contains">
                        <h:outputText value="#{urlop.akceptant.fullname}"/>
                    </p:column>
                    <p:column headerText="Więcej" style="width:36px">
                        <p:rowToggler />
                    </p:column>
                    <p:rowExpansion>
                        <p:panel header="historia" rendered="#{fn:length(urlop.wnHistoriaList)>0}">
                            <p:dataTable id="histTab" value="#{urlop.wnHistoriaList}" var="hist">
                                <p:column headerText="data zmiany">
                                    <h:outputText value="#{hist.dataZmiany}"><f:convertDateTime type="date" pattern="yyyy-MM-dd HH:mm:ss" timeZone="CET"/></h:outputText>
                                </p:column>
                                <p:column headerText="Zmianę wykonał">
                                    <h:outputText value="#{hist.zmieniajacy.fullname}"/>
                                </p:column>
                                <p:column headerText="Status" style="alignment-adjust: central">
                                    <h:outputText value="#{hist.statusId.opis}"/>
                                </p:column>
                                <p:column>
                                    <p:panel>
                                        <h:outputText value=" [opis] " id="opis"/>
                                        <p:tooltip id="tt1">
                                            <h:outputText value="#{hist.opisZmiany}"/>
                                        </p:tooltip>
                                    </p:panel>
                                </p:column>
                                <p:column headerText="Akceptant">
                                    <h:outputText value="#{hist.akceptant.fullname}"/>
                                </p:column>
                            </p:dataTable>
                        </p:panel>
                        <p:panel header="informacje dodatkowe" rendered="#{urlop.rodzajId.id==5 or urlop.rodzajId.id==6}">
                            <p:panelGrid columns="2" columnClasses="column1p, column2p">
                                <p:outputLabel for="miejsce" value="miejsce: " />
                                <h:outputText id="miejsce" value="#{urlop.miejsce}" />

                                <p:outputLabel for="cel" value="cel: " />
                                <h:outputText id="cel" value="#{urlop.cel}" />

                                <p:outputLabel for="srodekLok" value="srodek lokomocji: " />
                                <h:outputText id="srodekLok" value="#{urlop.srodekLok}"/>
                            </p:panelGrid>
                        </p:panel>
                    </p:rowExpansion>
                    <p:column headerText="Akcje" style="width: 90px">
                        <p:tooltip for="imgEd" value="edytuj"/>
                        <p:tooltip for="imgAn" value="anuluj"/>
                        <p:tooltip for="imgDe" value="usun"/>
                        <p:tooltip for="imgWy" value="wyślij"/>
                        <p:commandButton id="imgDe" rendered="#{urlop.statusId.id==1 or urlop.statusId.id==5}" update=":center:formTab, :infoForm:messages" process="imgDe" 
                                         icon="ui-icon-trash" action="#{UrlopM.usun}" oncomplete="PF('tableV').filter();">
                            <p:confirm header="Potwierdzenie" message="Czy jesteś pewny?" icon="ui-icon-alert" />
                            <f:setPropertyActionListener target="#{UrlopM.urlop}" value="#{urlop}"/>
                        </p:commandButton>
                        <p:commandButton id="imgEd" rendered="#{urlop.statusId.id==1 or urlop.statusId.id==5}" update=":center:form, :infoForm:messages" process="imgEd" icon="ui-icon-pencil" 
                                         oncomplete="PF('formWprowV').close();PF('formWprowV').show();">
                            <f:setPropertyActionListener target="#{UrlopM.urlop}" value="#{urlop}"/>
                        </p:commandButton>
                        <p:commandButton id="imgWy" action="#{UrlopM.wyslij}" rendered="#{urlop.statusId.id==1 or urlop.statusId.id==5}" update=":center:formTab, :infoForm:messages" 
                                         process="@this" icon="ui-icon-play" oncomplete="PF('tableV').filter();">
                            <f:setPropertyActionListener target="#{UrlopM.urlop}" value="#{urlop}"/>
                        </p:commandButton>
                        <p:message for="imgWy"/>
                        <p:commandButton id="imgAn" action="#{UrlopM.anuluj}" rendered="#{urlop.statusId.id==3}" update=":center:formTab, :infoForm:messages" 
                                          oncomplete="PF('tableV').filter();" process="@this" icon="ui-icon-circle-minus">
                            <f:setPropertyActionListener target="#{UrlopM.urlop}" value="#{urlop}"/>
                        </p:commandButton>
                    </p:column>
                </p:dataTable>
            </p:outputPanel>
        </h:form>
    </ui:define>
</ui:composition>
