<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets" 
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                template="/templates/templateGPF.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions">
    <ui:define name="tytul">
        <h3 align="center">Twoje wnioski urlopowe</h3>
    </ui:define>
    <ui:define name="content" id="content">
        <h:form id="center">
            <p:defaultCommand target="dummy"/>
            <p:commandButton id="dummy" process="@none" global="false" style="display:none;"/>

            <p:fieldset id="formWprow" collapsed="#{UrlopM.urlop.id==null}" toggleable="true" legend="Dodaj/Edytuj wniosek (zwiń/rozwiń)" widgetVar="formWprowV">
                <p:panelGrid columns="3" id="form" columnClasses="column1, column2">
                    <p:outputLabel for="name" value="Imię i nazwisko: "/>
                    <h:inputText id="name" value="#{UrlopM.urlop.uzytkownik.fullname}"  size="50" readonly="true"/>
                    <p:message for="name" styleClass="error" />

                    <p:outputLabel for="rodzajW" value="Zwracam się z prośbą o udzielenie urlopu (rodzaj):"/>
                    <p:selectOneMenu id="rodzajW" value="#{UrlopM.urlop.rodzajId}" converter="#{WnRodzajeConv}">
                        <f:selectItems value="#{UrlopM.rodzajeC.findWnRodzajeEntities}" var="rodzaj" itemValue="#{rodzaj}" itemLabel="#{rodzaj.opis}"/>
                        <p:ajax update="form" process="rodzajW"/>
                    </p:selectOneMenu>
                    <p:message for="rodzajW" styleClass="error" />

                    <p:outputLabel for="data_od" value="Data od:" rendered="#{UrlopM.urlop.rodzajId.id!=3 and UrlopM.urlop.rodzajId.id!=30 and UrlopM.urlop.rodzajId.id!=40}"/>
                    <p:calendar id="data_od" value="#{UrlopM.urlop.dataOd}" pattern="yyyy-MM-dd" locale="pl" rendered="#{UrlopM.urlop.rodzajId.id!=3 and UrlopM.urlop.rodzajId.id!=30 and UrlopM.urlop.rodzajId.id!=40}"/>
                    <p:message for="data_od" styleClass="error" rendered="#{UrlopM.urlop.rodzajId.id!=3 and UrlopM.urlop.rodzajId.id!=30 and UrlopM.urlop.rodzajId.id!=40}"/>

                    <p:outputLabel for="data_do" value="Data do:" rendered="#{UrlopM.urlop.rodzajId.id!=3 and UrlopM.urlop.rodzajId.id!=30 and UrlopM.urlop.rodzajId.id!=40}"/>
                    <p:calendar id="data_do" value="#{UrlopM.urlop.dataDo}" pattern="yyyy-MM-dd" locale="pl" rendered="#{UrlopM.urlop.rodzajId.id!=3 and UrlopM.urlop.rodzajId.id!=30 and UrlopM.urlop.rodzajId.id!=40}"/>
                    <p:message for="data_do" styleClass="error" rendered="#{UrlopM.urlop.rodzajId.id!=3 and UrlopM.urlop.rodzajId.id!=30 and UrlopM.urlop.rodzajId.id!=40}"/>

                    <p:outputLabel for="data_url" value="Dzień urlopu:" rendered="#{UrlopM.urlop.rodzajId.id==3 or UrlopM.urlop.rodzajId.id==30}"/>
                    <p:outputLabel for="data_url" value="Dzień nadgodzin:" rendered="#{UrlopM.urlop.rodzajId.id==40}"/>
                    <p:calendar id="data_url" value="#{UrlopM.dataUrlopu}" pattern="yyyy-MM-dd" locale="pl" rendered="#{UrlopM.urlop.rodzajId.id==40 or UrlopM.urlop.rodzajId.id==30 or UrlopM.urlop.rodzajId.id==3}"/>
                    <p:message for="data_url" styleClass="error" rendered="#{UrlopM.urlop.rodzajId.id==40 or UrlopM.urlop.rodzajId.id==30 or UrlopM.urlop.rodzajId.id==3}"/>

                    <p:outputLabel value="Godzina od:" rendered="#{UrlopM.urlop.rodzajId.id==40 or UrlopM.urlop.rodzajId.id==30 or UrlopM.urlop.rodzajId.id==3}"/>
                    <p:calendar id="data_od_godz" value="#{UrlopM.godzOdT}" pattern="HH:00" timeOnly="true" locale="pl" rendered="#{UrlopM.urlop.rodzajId.id==40 or UrlopM.urlop.rodzajId.id==30 or UrlopM.urlop.rodzajId.id==3}"/>
                    <p:message for="data_od_godz" styleClass="error" rendered="#{UrlopM.urlop.rodzajId.id==40 or UrlopM.urlop.rodzajId.id==30 or UrlopM.urlop.rodzajId.id==3}"/>

                    <p:outputLabel for="data_do_godz" value="Godzina do:" rendered="#{UrlopM.urlop.rodzajId.id==40 or UrlopM.urlop.rodzajId.id==30 or UrlopM.urlop.rodzajId.id==3}"/>
                    <p:calendar id="data_do_godz" value="#{UrlopM.godzDoT}" pattern="HH:00" timeOnly="true" locale="pl" rendered="#{UrlopM.urlop.rodzajId.id==40 or UrlopM.urlop.rodzajId.id==30 or UrlopM.urlop.rodzajId.id==3}"/>
                    <p:message for="data_do_godz" styleClass="error" rendered="#{UrlopM.urlop.rodzajId.id==40 or UrlopM.urlop.rodzajId.id==30 or UrlopM.urlop.rodzajId.id==3}"/>

                    <p:outputLabel for="extraemail" value="Czy wysłać informacje na dodatkowe e-maile?" rendered="#{fn:length(UrlopM.urlop.uzytkownik.struktura.extraemail)>0}"/>
                    <h:selectBooleanCheckbox value="#{UrlopM.urlop.extraemail}" rendered="#{fn:length(UrlopM.urlop.uzytkownik.struktura.extraemail)>0}"/>
                    <h:outputText id="extraemail" value="#{UrlopM.urlop.uzytkownik.struktura.extraemail}" rendered="#{fn:length(UrlopM.urlop.uzytkownik.struktura.extraemail)>0}"/>

                    <p:outputLabel for="pracodawca" value="Pracodawca: " rendered="#{UrlopM.urlop.rodzajId.id==40}"/>
                    <p:inputSwitch id="pracodawca" value="#{UrlopM.urlop.pracodawca}" rendered="#{UrlopM.urlop.rodzajId.id==40}" onLabel="Tak" offLabel="Nie"/>
                    <p:message for="pracodawca" styleClass="error" rendered="#{UrlopM.urlop.rodzajId.id==40}"/>

                    <p:outputLabel value="Koszty szolenia:" rendered="#{UrlopM.urlop.rodzajId.id==30}"/>
                    <p:panelGrid columns="4" rendered="#{UrlopM.urlop.rodzajId.id==30}" columnClasses="column1, column2, column1, column2">
                        <p:outputLabel value="Temat szkolenia: " rendered="#{UrlopM.urlop.rodzajId.id==30}"/>
                        <p:inputText value="#{UrlopM.urlop.temat_szkolenia}" size="45"/>

                        <p:outputLabel for="wpisowe" value="Wpisowe: " rendered="#{UrlopM.urlop.rodzajId.id==30}"/>
                        <p:inputNumber id="wpisowe" value="#{UrlopM.urlop.wpisowe}" emptyValue="0.00" decimalSeparator="," thousandSeparator="&#160;" rendered="#{UrlopM.urlop.rodzajId.id==30}">
                            <p:ajax event="change" update="form" process="form"/>
                        </p:inputNumber>

                        <p:outputLabel for="koszty_dojazdu" value="Koszty dojazdu: " rendered="#{UrlopM.urlop.rodzajId.id==30}"/>
                        <p:inputNumber id="koszty_dojazdu" value="#{UrlopM.urlop.koszty_dojazdu}" emptyValue="0.00" decimalSeparator="," thousandSeparator="&#160;" rendered="#{UrlopM.urlop.rodzajId.id==30}">
                            <p:ajax event="change" update="form" process="form"/>
                        </p:inputNumber>

                        <p:outputLabel for="hotel" value="Hotel: " rendered="#{UrlopM.urlop.rodzajId.id==30}"/>
                        <p:inputNumber id="hotel" value="#{UrlopM.urlop.hotel}" emptyValue="0.00" decimalSeparator="," thousandSeparator="&#160;" rendered="#{UrlopM.urlop.rodzajId.id==30}">
                            <p:ajax event="change" update="form" process="form"/>
                        </p:inputNumber>

                        <p:outputLabel for="inne" value="Inne: " rendered="#{UrlopM.urlop.rodzajId.id==30}"/>
                        <p:inputNumber id="inne" value="#{UrlopM.urlop.inne}" emptyValue="0.00" decimalSeparator="," thousandSeparator="&#160;" rendered="#{UrlopM.urlop.rodzajId.id==30}">
                            <p:ajax event="change" update="form" process="form"/>
                        </p:inputNumber>

                        <p:outputLabel for="kwota" value="Przewidywane koszty: " rendered="#{UrlopM.urlop.rodzajId.id==30}"/>
                        <p:inputNumber id="kwota" value="#{UrlopM.urlop.kwotaWs}" emptyValue="0.00" decimalSeparator="," thousandSeparator="&#160;" rendered="#{UrlopM.urlop.rodzajId.id==30}" disabled="true">
                        </p:inputNumber>
                    </p:panelGrid>
                    <p:spacer rendered="#{UrlopM.urlop.rodzajId.id==30}"/>

                    <p:outputLabel for="infoDod" value="Informacje dodatkowe: "/>
                    <h:inputTextarea id="infoDod" value="#{UrlopM.urlop.infoDod}" cols="52"/>
                    <p:message for="infoDod" styleClass="error" />

                    <p:outputLabel for="miejsce" value="Delegacja - miejsce: " rendered="#{UrlopM.urlop.rodzajId.id==5 or UrlopM.urlop.rodzajId.id==6}"/>
                    <h:inputText id="miejsce" value="#{UrlopM.urlop.miejsce}" size="50" rendered="#{UrlopM.urlop.rodzajId.id==5 or UrlopM.urlop.rodzajId.id==6}"/>
                    <p:message for="miejsce" styleClass="error"  rendered="#{UrlopM.urlop.rodzajId.id==5 or UrlopM.urlop.rodzajId.id==6}"/>

                    <p:outputLabel for="cel" value="Delegacja - cel: " rendered="#{UrlopM.urlop.rodzajId.id==5 or UrlopM.urlop.rodzajId.id==6}"/>
                    <h:inputText id="cel" value="#{UrlopM.urlop.cel}" size="50" rendered="#{UrlopM.urlop.rodzajId.id==5 or UrlopM.urlop.rodzajId.id==6}"/>
                    <p:message for="cel" styleClass="error"  rendered="#{UrlopM.urlop.rodzajId.id==5 or UrlopM.urlop.rodzajId.id==6}"/>

                    <p:outputLabel for="srodekLok" value="Delegacja - srodek lokomocji: " rendered="#{UrlopM.urlop.rodzajId.id==5 or UrlopM.urlop.rodzajId.id==6}"/>
                    <h:inputText id="srodekLok" value="#{UrlopM.urlop.srodekLok}" size="50" rendered="#{UrlopM.urlop.rodzajId.id==5 or UrlopM.urlop.rodzajId.id==6}"/>
                    <p:message for="srodekLok" styleClass="error"  rendered="#{UrlopM.urlop.rodzajId.id==5 or UrlopM.urlop.rodzajId.id==6}"/>

                </p:panelGrid>
                <center>
                    <p:message for="dodaj" styleClass="error"/>
                    <p:commandButton id="dodaj" value="Zapisz wniosek" action="#{UrlopM.dodaj}" update=":infoForm:messages, formTab, formWprow" process="formWprow" oncomplete="PF('tableV').clearFilters()"/>
                </center>
            </p:fieldset>

            <p:outputPanel id="formTab" layout="block">
                <p:dataTable value="#{UrlopM.urlopyList}" var="urlop" id="table" paginator="true" rowsPerPageTemplate="10, 20, 50, 100" rows="10" sortBy="#{urlop.id}" sortOrder="descending" widgetVar="tableV" emptyMessage="brak danych">
                    <p:column headerText="Wniosek złożony przez">
                        <h:outputText value="#{urlop.przyjmujacy.fullname}" rendered="#{urlop.przyjmujacy!=null}"/>
                        <h:outputText value="#{urlop.uzytkownik.fullname}" rendered="#{urlop.przyjmujacy==null}"/>
                    </p:column>
                    <p:column headerText="Nr wniosku" filterBy="#{urlop.nrWniosku}" filterMatchMode="contains">
                        <h:outputText value="#{urlop.nrWniosku}"/>
                        <p:separator/>
                        <h:outputText value="#{urlop.infoDod}" rendered="#{fn:length(urlop.infoDod)>0}"/>
                    </p:column>
                    <p:column headerText="Rodzaj" filterBy="#{urlop.rodzajId.opis}" filterMatchMode="contains">
                        <h:outputText value="#{urlop.rodzajId.opis}"/>
                    </p:column>
                    <p:column headerText="Wprowadzony" sortBy="#{urlop.dataWprowadzenia}">
                        <h:outputText value="#{urlop.dataWprowadzenia}"><f:convertDateTime type="date" pattern="yyyy-MM-dd HH:mm:ss" timeZone="CET"/></h:outputText>
                    </p:column>
                    <p:column headerText="Od Do" sortBy="#{urlop.dataOd}">
                        <h:outputText value="#{urlop.dataOd}" rendered="#{urlop.rodzajId.id==40 or urlop.rodzajId.id==30 or urlop.rodzajId.id==3}">
                            <f:convertDateTime type="date" pattern="yyyy-MM-dd HH:mm" locale="#{UrlopM.locale}" timeZone="CET"/></h:outputText>
                        <h:outputText value="#{urlop.dataOd}" rendered="#{!(urlop.rodzajId.id==40 or urlop.rodzajId.id==30 or urlop.rodzajId.id==3)}">
                            <f:convertDateTime type="date" pattern="yyyy-MM-dd" locale="#{UrlopM.locale}" timeZone="CET"/></h:outputText>
                        <p:separator/>
                        <h:outputText value="#{urlop.dataDo}" rendered="#{urlop.rodzajId.id==40 or urlop.rodzajId.id==30 or urlop.rodzajId.id==3}">
                            <f:convertDateTime type="date" pattern="yyyy-MM-dd HH:mm" locale="#{UrlopM.locale}" timeZone="CET"/></h:outputText>
                        <h:outputText value="#{urlop.dataDo}" rendered="#{!(urlop.rodzajId.id==40 or urlop.rodzajId.id==30 or urlop.rodzajId.id==3)}">
                            <f:convertDateTime type="date" pattern="yyyy-MM-dd" locale="#{UrlopM.locale}" timeZone="CET"/></h:outputText>
                    </p:column>
                    <p:column headerText="Status" filterBy="#{urlop.statusId.opis}" filterMatchMode="contains" style="background-color: #{urlop.statusId.kolor} ; text-align: center">
                        <h:outputText value="#{urlop.statusId.opis}"/>
                    </p:column>
                    <p:column headerText="Akceptant" filterBy="#{urlop.akceptant.fullname}" filterMatchMode="contains">
                        <h:outputText value="#{urlop.akceptant.fullname}"/>
                    </p:column>
                    <p:column headerText="Więcej" style="width:36px">
                        <p:rowToggler id="wiecej"/>
                        <p:tooltip for="wiecej" value="rozwiń"/>
                    </p:column>
                    <p:rowExpansion>
                        <p:panel header="Informacje dodatkowe" rendered="#{urlop.rodzajId.id==5 or urlop.rodzajId.id==6}">
                            <p:panelGrid columns="2" columnClasses="column1p, column2p">
                                <p:outputLabel for="miejsce" value="Miejsce: " />
                                <h:outputText id="miejsce" value="#{urlop.miejsce}" />

                                <p:outputLabel for="cel" value="Cel: " />
                                <h:outputText id="cel" value="#{urlop.cel}" />

                                <p:outputLabel for="srodekLok" value="Środek lokomocji: " />
                                <h:outputText id="srodekLok" value="#{urlop.srodekLok}"/>
                            </p:panelGrid>
                        </p:panel>
                        <p:panel header="Informacje dodatkowe" rendered="#{urlop.rodzajId.id==30}">
                            <p:panelGrid columns="6" columnClasses="column1p, column2p,column1p, column2p,column1p, column2p">
                                <p:outputLabel value="Temat szkolenia: "/>
                                <h:outputText value="#{urlop.temat_szkolenia}"/>

                                <p:outputLabel value="Wpisowe: "/>
                                <h:outputText value="#{urlop.wpisowe}">
                                    <f:convertNumber currencyCode="PLN" type="currency" minFractionDigits="2"/>
                                </h:outputText>
                                
                                <p:outputLabel value="Koszty dojazdu: "/>
                                <h:outputText value="#{urlop.koszty_dojazdu}">
                                    <f:convertNumber currencyCode="PLN" type="currency" minFractionDigits="2"/>
                                </h:outputText>
                                
                                <p:outputLabel value="Hotel: "/>
                                <h:outputText value="#{urlop.hotel}">
                                    <f:convertNumber currencyCode="PLN" type="currency" minFractionDigits="2"/>
                                </h:outputText>
                                
                                <p:outputLabel value="Inne: "/>
                                <h:outputText value="#{urlop.inne}">
                                    <f:convertNumber currencyCode="PLN" type="currency" minFractionDigits="2"/>
                                </h:outputText>

                                <p:outputLabel value="Przewidywana kwota: " />
                                <h:outputText value="#{urlop.kwotaWs}">
                                    <f:convertNumber currencyCode="PLN" type="currency" minFractionDigits="2"/>
                                </h:outputText>
                            </p:panelGrid>
                        </p:panel>
                        <p:panel header="Informacje dodatkowe" rendered="#{urlop.rodzajId.id==40}">
                            <p:panelGrid columns="2" columnClasses="column1p, column2p">
                                <p:outputLabel value="Pracodawca: " />
                                <p:inputSwitch value="#{urlop.pracodawca}" offLabel="Nie" onLabel="Tak" disabled="true"/>
                            </p:panelGrid>
                        </p:panel>
                        <p:panel header="Historia" rendered="#{fn:length(urlop.wnHistoriaList)>0}">
                            <p:dataTable id="histTab" value="#{urlop.wnHistoriaList}" var="hist">
                                <p:column headerText="Data zmiany">
                                    <h:outputText value="#{hist.dataZmiany}"><f:convertDateTime type="date" pattern="yyyy-MM-dd HH:mm:ss" timeZone="CET"/></h:outputText>
                                </p:column>
                                <p:column headerText="Zmianę wykonał">
                                    <h:outputText value="#{hist.zmieniajacy.fullname}"/>
                                </p:column>
                                <p:column headerText="Status" style="alignment-adjust: central">
                                    <h:outputText value="#{hist.statusId.opis}"/>
                                </p:column>
                                <p:column headerText="Opis zmiany">
                                    <p:panel>
                                        <h:outputText value="#{hist.opisZmiany}" id="opis"/>
                                    </p:panel>
                                </p:column>
                                <p:column headerText="Akceptant">
                                    <h:outputText value="#{hist.akceptant.fullname}"/>
                                </p:column>
                            </p:dataTable>
                        </p:panel>
                    </p:rowExpansion>
                    <p:column headerText="Akcje" style="width: 90px">
                        <p:tooltip for="imgEd" value="Edytuj"/>
                        <p:tooltip for="imgAn" value="Anuluj"/>
                        <p:tooltip for="imgDe" value="Usun"/>
                        <p:tooltip for="imgWy" value="Wyślij"/>
                        <p:commandButton id="imgDe" rendered="#{urlop.statusId.id==1 or urlop.statusId.id==5}" update=":center:formTab, :infoForm:messages" process="imgDe" 
                                         icon="ui-icon-trash" action="#{UrlopM.usun}" oncomplete="PF('tableV').filter();">
                            <p:confirm header="Potwierdzenie" message="Czy jesteś pewny?" icon="ui-icon-alert" />
                            <f:setPropertyActionListener target="#{UrlopM.urlop}" value="#{urlop}"/>
                        </p:commandButton>
                        <p:commandButton id="imgEd" rendered="#{urlop.statusId.id==1 or urlop.statusId.id==5}" update=":center:formWprow, :infoForm:messages" process="imgEd" icon="ui-icon-pencil">
                            <f:setPropertyActionListener target="#{UrlopM.urlop}" value="#{urlop}"/>
                            <f:setPropertyActionListener target="#{UrlopM.godzOdT}" value="#{urlop.dataOd}"/>
                            <f:setPropertyActionListener target="#{UrlopM.godzDoT}" value="#{urlop.dataDo}"/>
                            <f:setPropertyActionListener target="#{UrlopM.dataUrlopu}" value="#{urlop.dataOd}"/>
                        </p:commandButton>
                        <p:commandButton id="imgWy" action="#{UrlopM.wyslij}" rendered="#{urlop.statusId.id==1 or urlop.statusId.id==5}" update=":center:formTab, :infoForm:messages" 
                                         process="@this" icon="ui-icon-play" oncomplete="PF('tableV').filter();">
                            <f:setPropertyActionListener target="#{UrlopM.urlop}" value="#{urlop}"/>
                        </p:commandButton>
                        <p:message for="imgWy"/>
                        <p:commandButton id="imgAn" action="#{UrlopM.anuluj}" rendered="#{urlop.statusId.id==3}" update=":center:formTab, :infoForm:messages" 
                                         oncomplete="PF('tableV').filter();" process="@this" icon="ui-icon-circle-minus">
                            <f:setPropertyActionListener target="#{UrlopM.urlop}" value="#{urlop}"/>
                        </p:commandButton>
                    </p:column>
                </p:dataTable>
            </p:outputPanel>
        </h:form>
    </ui:define>
</ui:composition>
