<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:p="http://primefaces.org/ui"
      xmlns:fn="http://java.sun.com/jsp/jstl/functions"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets">

    <p:remoteCommand oncomplete="PF('dodajPane').show();" autoRun="true" rendered="#{fn:length(RejestracjaRej.obiekt.dcPlikList)>0}"/>

    <p:dialog header="Wprowadź podstawowe informacje" id="dodajPane" widgetVar="dodajPane">
        <ui:include src="./dokumentEdit.xhtml">
            <ui:param name="detal" value="#{false}"/> 
        </ui:include>
        <p:commandButton id="dodaj" value="Dodaj" action="#{managedBean.dodaj}" update=":center:listPanel, dodajPane" process="dodajPane"
                         oncomplete="if (#{facesContext.maximumSeverity==null}) {#{p:component('dodajPane')}.hide();} else {#{p:component('dodajPane')}.show();}" 
                         rendered="#{RejestracjaRej.obiekt.id==null}"/>
        <p:commandButton id="zapisz" value="Zapisz" action="#{managedBean.edytuj}" update=":center:listPanel, dodajPane" process="dodajPane"
                         oncomplete="if(#{facesContext.maximumSeverity==null}) {#{p:component('dodajPane')}.hide();}  else {#{p:component('dodajPane')}.show();}" 
                         rendered="#{RejestracjaRej.obiekt.id!=null}"/>
        <p:commandButton value="Wyjdź" action="#{RejestracjaRej.refreshObiekt}" update="dodajPane" oncomplete="#{p:component('dodajPane')}.hide(); return false;" process="@this"/>
    </p:dialog>

    <p:panel id="listPanel">
        <h4>
            <p:commandButton value="dodaj dokument" process="@this" oncomplete="PF('dodajPane')}.show();" 
                             action="#{RejestracjaRej.refreshObiekt}" rendered="#{!brakDodaj}"/>
        </h4>

        <p:dataTable value="#{managedBean.lista}" var="item" id="table" paginator="true" rows="10" rowsPerPageTemplate="10,20,50"
                     emptyMessage="brak rekordów" style="width: 100%" sortOrder="descending" sortBy="#{item.id}">
            <p:column headerText="znaleziono w" rendered="#{infoWyszuk}">
                uzupelnic
            </p:column>

            <p:column headerText="data rejestracji" sortBy="#{item.id}">
                <h:outputText value="#{item.dataWprow}"><f:convertDateTime type="date" pattern="yyyy-MM-dd HH:mm:ss" timeZone="CET"/></h:outputText>
                <br/>
                <h:outputText value="przeterminowany" style="background-color: red" rendered="#{item.alertAkceptacja}"/>
            </p:column>

            <p:column headerText="nazwa i symbol" filterBy="#{item.nazwa} #{item.symbolDok}" filterMatchMode="contains">
                <h:outputText id="nazwaList" value="#{item.nazwa}" style="font-size: small"/>
                <br/>
                <h:outputText id="symbolDok" value="#{item.symbolDok}" style="font-size: small"/>

                <p:tooltip for="nazwaList">
                    #{item.opis}
                </p:tooltip>
            </p:column>

            <p:column headerText="data dokumentu" filterBy="#{item.dataDok}" filterMatchMode="contains">
                <h:outputText value="#{item.dataDok}"><f:convertDateTime type="date" pattern="yyyy-MM-dd" timeZone="CET"/></h:outputText>
                <br/>
                <h:outputText value="do brakowania" style="background-color: red" rendered="#{item.alertBrakowanie}"/><br/>
            </p:column>

            <p:column headerText="kontrahent" filterMatchMode="contains" filterBy="#{item.kontrahentId.nazwa}" rendered="#{!widok}">    
                <h:outputText id="kontrahentList" value="#{item.kontrahentId.nazwa}"/>
                <p:tooltip for="kontrahentList">
                    #{item.kontrahentId.adres} #{item.kontrahentId.infoDod} #{item.kontrahentId.nipRegon}
                </p:tooltip>
            </p:column>

            <p:column headerText="żródło" filterMatchMode="contains" filterBy="#{item.zrodloId.nazwa}">
                #{item.zrodloId.nazwa}
            </p:column>

            <p:column headerText="teczka" filterMatchMode="contains" filterBy="#{item.teczkaId.nazwa}">    
                <h:outputText id="teczka" value="#{item.teczkaId.nazwa}"/>
                <p:tooltip for="teczka">
                    #{item.teczkaId.opis}
                </p:tooltip>
            </p:column>

            <p:column style="background-color: #{item.dokStatusId.kolor}; text-align: center;" headerText="status" filterMatchMode="contains" filterBy="#{item.dokStatusId.nazwa}">    
                <p:outputLabel for="procentWykonania" value="proces akceptacji: "/>
                <h:outputText id="procentWykonania" value="#{item.procentWykonania}"/>
                <br/>
                <h:outputText id="statusList" value="#{item.dokStatusId.nazwa}"/>
                <br/>
                <p:commandButton value="wyślij do akceptacji" action="#{RejestracjaRej.wyslijDoAkceptacji}" update=":center:listPanel" rendered="#{item.dokStatusId.id==1}" process="@this">
                    <f:setPropertyActionListener target="#{RejestracjaRej.obiekt}" value="#{item}" />
                </p:commandButton>
                <p:tooltip for="statusList">
                    #{item.dokStatusId.opis}
                </p:tooltip>
            </p:column>

            <p:column headerText="wprowadził" filterMatchMode="contains" filterBy="#{item.userId.fullname}">    
                #{item.userId.fullname}
            </p:column>

            <p:column headerText="rodzaj" filterMatchMode="contains" filterBy="#{item.rodzajId.nazwa}">    
                <h:outputText id="rodzajList" value="#{item.rodzajId.nazwa}"/>
                <p:tooltip for="rodzajList">
                    #{item.rodzajId.opis} z grupy:#{item.rodzajId.idRodzajGrupa.nazwa}
                </p:tooltip>
            </p:column>

        </p:dataTable>
    </p:panel>
</html>

